{% extends 'twitter/main_admin.html'%}
{% block title %}

Chatbot Intents

{% endblock %}
{% block content %}

<div class="mcw">
  <!--navigation here-->
  <!--main content view-->
  <div class="cv">
    <div>
     <div class="inbox">

       <div class="inbox-bx container-fluid">
<div class="container">   
<!-- ======================================================================================= -->
<button type="button" class="btn btn-primary btn_int" data-toggle="modal" data-target="#exampleModalCenter">
  Add new intents
</button>


<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Add new intents</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form method="POST" id="new_intents_form" action="">
      	{% csrf_token %}
      <div class="modal-body">
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text" id="inputGroup-sizing-default">Tag</span>
			</div>
			<input type="text" name="tag" id="tag" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" required="">
			 <small class="text-red text-muted mySpan"></small>
		</div>


		<div class="form-group">
			<label for="exampleFormControlTextarea1">Patterns:</label>
			<textarea class="form-control" id="pattern"  name="pattern" rows="3" required></textarea>
		</div>
		<div class="form-group" >
			<label for="exampleFormControlTextarea1">Responses:</label>
			<textarea class="form-control" id="response"  name="response" rows="3" required></textarea>
			 
		</div>


	
			<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text" id="inputGroup-sizing-default">Context:</span>
			</div>
			<input type="text" name="context" id="context" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" value=" ">
		</div>
	    
		<div class="form-group" >
			<label for="exampleFormControlTextarea1">Context Set</label>
			<textarea class="form-control" id="context_set"  name="context_set" rows="3" value=" "></textarea>
		</div>
	
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" name="submit_add">Save changes</button>
      </div>
      </form>
    </div>
  </div>
</div>
<!-- ======================================================================================= -->


            <section class="recent">
                    <!-- ------------------------ -->
                    <div class="activity-card">
                    <div id="header-card">
                        <h3>DATABASE INTENTS</h3>
                    </div>

                        <div class="table-responsive">
                            <table id="myTable" class="table" >
                                <thead>
                                	<tr>
                                		
                                		<th>#</th>
                                		<th>Tag</th>
                                		<th>Patterns</th>
                                		<th>Responses</th>
                                		<th>Context</th>
                                		<th>Context Set</th>
                                		<th>Delete</th>
                                	</tr>
                                </thead>
                                <tbody>
                                        {% for i in intents %}
                                        <tr class="record">
                                 
                                        	<td>{{ forloop.counter }}</td>
                                        	<td>{{i.tag}}</td>
                                        	<td>{{i.pattern}}</td>
                                        	<td>{{i.response}}</td>
                                        	<td>{{i.context}}</td>
                                        	<td>{{i.context_set}}</td>
    <td><p data-placement="top" data-toggle="tooltip" title="Delete"><a href="{% url 'twitter:updata_delete' i.id_tag %}" class="link-delete btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="las la-trash-alt"></span></a></p></td>
                                        </tr>
                                        {% endfor %}
                                    
                                </tbody>
                            </table>

                        </div>
                    </div>    
            </section>
</div>

    </div>
     </div>
    </div>
  </div>
</div>

{% endblock content %}

{% block scripts %}
<!-- REFERENCE LINK -->
<!-- https://www.youtube.com/watch?v=rcbvOVQMjdE&t=109s -->





<!-- ========================================== -->


<script>
	$("#new_intents_form").on("submit", function(e){
	e.preventDefault();
		console.log("Hello")
		
		var url = '{% url "twitter:intents" %}'
		
		$.ajax({
			type:'POST',
			url:url,
			data:{
				tag:$('#tag').val(),
				patterns:$('#pattern').val(),
				responses:$('#response').val(),
				context:$('#context').val(),
				context_set:$('#context_set').val(),
				csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
			},
			success:function(data){
				console.log(data,"<<<")
				$("#exampleModalCenter").modal('hide');
				$('.modal-backdrop').hide();

				alert("Created new intents");
				$('#tag').val('');
				$('#pattern').val('');
				$('#response').val('');
				$('#context').val('');
				$('#context_set').val('');
				window.location = url;
			

			}
		});
	});


// $("#myTable tbody").on("click", ".link-edit", function(e){
// 	e.preventDefault();
// 	var $this = $(this);
// 	let tag = $this.parents(".record").find('td').eq(1).text();
// 	let pattern = $this.parents(".record").find('td').eq(2).text();
// 	let response = $this.parents(".record").find('td').eq(3).text();
// 	let context = $this.parents(".record").find('td').eq(4).text();
// 	let context_set = $this.parents(".record").find('td').eq(5).text();
// 	$("#new_intents_form2 input[name='tag']").val(tag);
// 	$("#new_intents_form2 textarea[name='pattern']").val(pattern);
// 	$("#new_intents_form2 textarea[name='response']").val(response);
// 	$("#new_intents_form2 input[name='context']").val(context);
// 	$("#new_intents_form2 textarea[name='context_set']").val(context_set);
// 	$("#new_intents_form2").attr("action", $this.attr('href'));
// 	$("#exampleModalCenter2").modal("show");
// 	return false;
// });



	$(".link-delete").on("click", function(e){
    e.preventDefault();

    var $this = $(this);
    if(confirm("Sure to delete?")){
        $.ajax({
            url: $this.attr("href"),
            type: "GET",
            dataType: "json",
            success: function(resp){
                if(resp.message == "success"){
                    $this.parents(".record").fadeOut("slow", function(){
                        $this.parents(".record").remove();
                    });
                }else{
                    alert(resp.message);
                }
            }
        });
    }
    return false;
});



</script>
{% endblock scripts %}

  